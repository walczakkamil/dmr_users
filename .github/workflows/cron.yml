name: Script cron

on:
    schedule:
        - cron: "0 5 * * *"

    workflow_dispatch:

env:
    GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

jobs:
    update:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3

            - name: Run the script
              run: bash script.sh

            - name: Upload files
              uses: actions/upload-artifact@v2
              with:
                  path: databases

            - name: Update release
              run: |
                TODAY=$(date +"%Y%m%d")
                gh release delete ${TODAY} -y
                gh release create ${TODAY}
                gh release upload ${TODAY} databases/* --clobber

            - uses: dev-drprasad/delete-older-releases@v0.3.2
              with:
                repo: <owner>/<repoName> # defaults to current repo
                keep_latest: 3
                keep_min_download_counts: 1 # Optional parameters
                delete_expired_data: 10 # Optional parameters
              env:
                GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
